function calculateDiscount() {
    let discountCriteria = document.getElementById('discountCriteria');
    let selectedDiscounts = Array.from(discountCriteria.selectedOptions).map(option => option.value);
    let totalDiscount = 0;
    
    // التحقق من وجود "أبناء عاملين" ومنع اختيار أي خصم آخر
    if (selectedDiscounts.includes('workerChildren')) {
        selectedDiscounts = ['workerChildren'];
    }

    // التحقق من وجود الخصومات المتضادة
    if (selectedDiscounts.includes('goldenBatch') && selectedDiscounts.includes('silverBatch')) {
        alert("لا يمكن اختيار الدفعة الذهبية والفضية معًا.");
        return;
    }
    if (selectedDiscounts.includes('topGrade') && selectedDiscounts.includes('excellentGrade')) {
        alert("لا يمكن اختيار درجة التفوق مع الإمتياز.");
        return;
    }
    if (selectedDiscounts.includes('cashBefore31May') && selectedDiscounts.includes('cashBefore31July')) {
        alert("لا يمكن اختيار السداد قبل 31/5 و 31/7 معًا.");
        return;
    }

    // تعريف نسب الخصم بناءً على ترتيب الاختيارات
    let discountPercentages = {
        'siblings': 0.05,       // 5%
        'topGrade': 0.10,       // 10%
        'excellentGrade': 0.05, // 5%
        'goldenBatch': 0.10,    // 10%
        'silverBatch': 0.05,    // 5%
        'workerChildren': 0.25, // 25%
        'cashBefore31May': 0.10, // 10%
        'cashBefore31July': 0.05, // 5%
        'championship': 0.10,   // 10%
        'quranHafiz': 0.10      // 10%
    };

    // حساب إجمالي الخصم بناءً على النسب المحددة
    selectedDiscounts.forEach(function(discount) {
        totalDiscount += discountPercentages[discount] || 0;
    });

    // التأكد من أن الخصم لا يتجاوز 25%
    if (totalDiscount > 0.25) {
        totalDiscount = 0.25; // الحد الأقصى للخصم هو 25%
    }

    // تطبيق الخصم على السعر
    discount = 1 - totalDiscount;

    // الآن نعرض المربع الذي يحتوي على الإجمالي بعد الخصم
    document.getElementById('totalAmount').classList.remove('hidden');
    
    // إظهار الخصومات المتوافقة
    let selectedOptionsList = document.getElementById('selectedOptionsList');
    selectedOptionsList.innerHTML = '';  // تفريغ القائمة قبل الإضافة
    selectedDiscounts.forEach(function(discount) {
        let listItem = document.createElement('li');
        listItem.textContent = discount;
        selectedOptionsList.appendChild(listItem);
    });

    document.getElementById('selectedOptions').classList.remove('hidden');

    // إظهار أسئلة الباص والكتب مباشرة بعد تحديد الخصم
    document.getElementById('busQuestion').classList.remove('hidden');
    document.getElementById('addBooksCostQuestion').classList.remove('hidden');

    updateTotalCost();
}
